@page
@model FootballScoutApp.Areas.Identity.Pages.Account.Manage.PlayerProfileModel
@{
    ViewData["Title"] = "Player Profile";
}

<h1>@ViewData["Title"]</h1>
<h4>Manage your player profile information.</h4>
<hr />
<div class="row">
    <div class="col-md-6">
        <form method="post" enctype="multipart/form-data">
            <div asp-validation-summary="All" class="text-danger"></div>


            <!-- Display Profile Photo -->
            <div class="form-group">
                <label>Profile Photo</label>
                @if (!string.IsNullOrEmpty(Model.Input.ProfilePhotoPath))
                {
                    <img src="@Model.Input.ProfilePhotoPath" alt="Profile Photo" style="max-width:200px;" />
                }
                else
                {
                    <p>No photo uploaded</p>
                }
            </div>

            <!-- Personal Information Section -->
            <div class="form-group">
                <label asp-for="Input.Firstname"></label>
                <input asp-for="Input.Firstname" class="form-control" readonly />
            </div>
            <div class="form-group">
                <label asp-for="Input.Lastname"></label>
                <input asp-for="Input.Lastname" class="form-control" readonly />
            </div>
            <div class="form-group">
                <label asp-for="Input.DateOfBirth"></label>
                <input asp-for="Input.DateOfBirth" class="form-control" type="date" />
                <span asp-validation-for="Input.DateOfBirth" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Input.Nationality"></label>
                <select asp-for="Input.Nationality" class="form-control">
                    <option value="">Select Nationality</option>
                    @foreach (var country in ViewData["Nationalities"] as List<string>)
                    {
                        <option value="@country">@country</option>
                    }
                </select>
                <span asp-validation-for="Input.Nationality" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Input.Birthplace"></label>
                <input asp-for="Input.Birthplace" class="form-control" />
                <span asp-validation-for="Input.Birthplace" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Input.Bio"></label>
                <textarea asp-for="Input.Bio" class="form-control"></textarea>
                <span asp-validation-for="Input.Bio" class="text-danger"></span>
            </div>


            <!-- Player Information Section -->
            <!-- Player Information Section -->
            <div class="form-group">
                <label asp-for="Input.Position"></label>
                <select asp-for="Input.Position" class="form-control">
                    <option value="">Select Position</option>
                    <option value="Goalkeeper">Goalkeeper</option>
                    <option value="Defender">Defender</option>
                    <option value="Midfielder">Midfielder</option>
                    <option value="Forward">Forward</option>
                </select>
                <span asp-validation-for="Input.Position" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Input.PreferredFoot"></label>
                <select asp-for="Input.PreferredFoot" class="form-control">
                    <option value="">Select Preferred Foot</option>
                    <option value="Right">Right</option>
                    <option value="Left">Left</option>
                    <option value="Both">Both</option>
                </select>
                <span asp-validation-for="Input.PreferredFoot" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Input.Height"></label>
                <input asp-for="Input.Height" class="form-control" />
                <span asp-validation-for="Input.Height" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Input.Weight"></label>
                <input asp-for="Input.Weight" class="form-control" />
                <span asp-validation-for="Input.Weight" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Input.InjuryHistory"></label>
                <textarea asp-for="Input.InjuryHistory" class="form-control"></textarea>
                <span asp-validation-for="Input.InjuryHistory" class="text-danger"></span>
            </div>

            <!-- Profile Photo Upload Section -->
            <div class="form-group">
                <label asp-for="Input.ProfilePhoto"></label>
                <input asp-for="Input.ProfilePhoto" class="form-control" type="file" />
                <span asp-validation-for="Input.ProfilePhoto" class="text-danger"></span>
            </div>

            <!-- YouTube Video Upload Section -->
            <div class="form-group">
                <label for="VideoUrl">Add Video URL</label>
                <button type="button" class="btn btn-secondary mb-2" onclick="addYoutubeVideoRow()">Add Video</button>

                <div id="youtubeVideosContainer">
                    @if (Model.Input.YoutubeVideoUrls?.Count > 0)
                    {
                        @for (int i = 0; i < Model.Input.YoutubeVideoUrls.Count; i++)
                        {
                            <div class="form-group" id="videoRow-@i">
                                <!-- Hidden field to store the video URL -->
                                <input type="hidden" name="Input.YoutubeVideoUrls[@i]" value="@Model.Input.YoutubeVideoUrls[i]" />

                                <!-- Display the video preview -->
                                <div class="embed-responsive embed-responsive-16by9 mb-3">
                                    <iframe class="embed-responsive-item"
                                            src="https://www.youtube.com/embed/@Model.Input.YoutubeVideoUrls[i].Split('=')[1]"
                                            allowfullscreen></iframe>
                                </div>

                                <!-- Remove button -->
                                <button type="button" class="btn btn-danger" onclick="removeYoutubeVideoRow(@i)">Remove</button>
                            </div>
                        }
                    }
                </div>
            </div>


            <!-- Previous Clubs Section -->
            <div class="form-group">
                <label>Previous Clubs</label>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Club Name</th>
                            <th>Year From</th>
                            <th>Year To</th>
                            <th>Appearances</th>
                            <th>Goals</th>
                            <th>Clean Sheets</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.Input.PreviousClubs?.Count > 0)
                        {
                            @for (int i = 0; i < Model.Input.PreviousClubs.Count; i++)
                            {
                                <tr>
                                    <td><input asp-for="Input.PreviousClubs[@i].ClubName" class="form-control" /></td>
                                    <td><input asp-for="Input.PreviousClubs[@i].YearFrom" class="form-control" type="number" /></td>
                                    <td><input asp-for="Input.PreviousClubs[@i].YearTo" class="form-control" type="number" /></td>
                                    <td><input asp-for="Input.PreviousClubs[@i].Appearances" class="form-control" /></td>
                                    <td><input asp-for="Input.PreviousClubs[@i].Goals" class="form-control" /></td>
                                    <td><input asp-for="Input.PreviousClubs[@i].CleanSheets" class="form-control" /></td>
                                </tr>
                            }
                        }
                        else
                        {
                            <!-- Provide a default row if there are no existing previous clubs -->
                            <tr>
                                <td><input name="Input.PreviousClubs[0].ClubName" class="form-control" /></td>
                                <td><input name="Input.PreviousClubs[0].YearFrom" class="form-control" type="number" /></td>
                                <td><input name="Input.PreviousClubs[0].YearTo" class="form-control" type="number" /></td>
                                <td><input name="Input.PreviousClubs[0].Appearances" class="form-control" /></td>
                                <td><input name="Input.PreviousClubs[0].Goals" class="form-control" /></td>
                                <td><input name="Input.PreviousClubs[0].CleanSheets" class="form-control" /></td>
                            </tr>
                        }
                    </tbody>
                </table>
                <button type="button" class="btn btn-secondary" onclick="addPreviousClubRow()">Add Club</button>
            </div>

            <button type="submit" class="btn btn-primary">Save Profile</button>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        function addPreviousClubRow() {
            var table = document.querySelector('table tbody');
            var row = document.createElement('tr');
            var rowCount = table.rows.length;
            row.innerHTML = `
                        <td><input name="Input.PreviousClubs[${rowCount}].ClubName" class="form-control" /></td>
                        <td><input name="Input.PreviousClubs[${rowCount}].YearFrom" class="form-control" type="number" /></td>
                        <td><input name="Input.PreviousClubs[${rowCount}].YearTo" class="form-control" type="number" /></td>
                        <td><input name="Input.PreviousClubs[${rowCount}].Appearances" class="form-control" /></td>
                        <td><input name="Input.PreviousClubs[${rowCount}].Goals" class="form-control" /></td>
                        <td><input name="Input.PreviousClubs[${rowCount}].CleanSheets" class="form-control" /></td>
                    `;
            table.appendChild(row);
        }
    </script>
    <script>
        function addYoutubeVideoRow() {
            var container = document.getElementById('youtubeVideosContainer');
            var rowCount = container.children.length;
            var div = document.createElement('div');
            div.className = 'form-group';
            div.id = `videoRow-${rowCount}`;
            div.innerHTML = `
                        <input type="text" class="form-control mb-2" placeholder="Enter YouTube URL" onblur="convertToEmbed(${rowCount}, this.value)" />
                    `;
            container.appendChild(div);
        }

        function convertToEmbed(index, url) {
            var container = document.getElementById(`videoRow-${index}`);
            if (url) {
                var iframe = `
                            <input type="hidden" name="Input.YoutubeVideoUrls[${index}]" value="${url}" />
                            <div class="embed-responsive embed-responsive-16by9 mb-3">
                                <iframe class="embed-responsive-item"
                                        src="https://www.youtube.com/embed/${url.split('=')[1]}"
                                        allowfullscreen></iframe>
                            </div>
                            <button type="button" class="btn btn-danger" onclick="removeYoutubeVideoRow(${index})">Remove</button>
                        `;
                container.innerHTML = iframe;
            } else {
                container.remove();
            }
        }

        function removeYoutubeVideoRow(index) {
            var row = document.getElementById(`videoRow-${index}`);
            if (row) {
                row.remove();
            }
        }
    </script>


}
